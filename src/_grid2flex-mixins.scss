// media queries
@mixin bp-from($bp-name) {
  $bp-value: map-get($breakpoints, $bp-name);

  @if ($bp-value > 0) {
    @media (min-width: $bp-value) {
      @content;
    }
  } @else {
    @content;
  }
}

// breakpoints prefixes with media queries
@mixin check-breakpoint($element, $breakpoints: $breakpoints, $configuration: $configuration) {
  $breakpoints-enabled: map-get($configuration, breakpoints-enabled);

  @if $breakpoints-enabled {
    @each $bp-value, $breakpoint in $breakpoints {
      @include bp-from($bp-value) {
        .#{$element}-#{$bp-value} {
          @content;
        }
      }
    }
  } @else {
    .#{$element} {
      @content;
    }
  }
}

// gutters
@mixin create-gutter($gutter, $configuration: $configuration) {
  $column: #{map-get($configuration, column)};

  margin-left: ($gutter / -2);
  margin-right: ($gutter / -2);

  > [class*="#{$column}-"] {
    padding-left: ($gutter / 2);
    padding-right: ($gutter / 2);
  }
}

// grid
@mixin create-grid($configuration: $configuration, $breakpoints: $breakpoints, $gutters: $gutters) {
  $columns-count: map-get($configuration, columns-count);
  $row: #{map-get($configuration, row)};
  $column: #{map-get($configuration, column)};
  $offsets-enabled: map-get($configuration, offsets-enabled);
  $breakpoints-enabled: map-get($configuration, breakpoints-enabled);

  // basic flex container (row)
  %row {
    display: flex;
    flex-wrap: wrap;
  }

  // rows and gutters
  @each $gutter-value, $gutter in $gutters {
    @if ($gutter-value != "gutter") {
      .#{$row}--#{$gutter-value} {
        @extend %row;
        @include create-gutter($gutter);
      }
    } @else {
      .#{$row} {
        @extend %row;
        @include create-gutter($gutter);
      }
    }
  }

  // columns
  [class*="#{$column}-"] {
    position: relative;
    min-height: 1px;
    margin-left: 0;
    margin-right: 0;
    flex-basis: 100%;
  }

  // 1. Workaround for IE: 'flex-basis' doesn't work with 'border-box' model of 'box-sizing'
  // 2. Fix: when column has 'flex' property 'max-width' doesn't work correctly

  // width calculation mixin
  @mixin width-calculation($element) {
    @for $i from 0 through $columns-count {
      @if ($i > 0) {
        &-#{$i} {
          flex: auto;
          width: percentage($i / $columns-count); // 1 
          max-width: percentage($i / $columns-count); // 2
        }
      } @else {
        // equal column width
        & {
          flex: 1;
          width: auto;
          max-width: 100%;
        }
      }
    }

    // content width column
    &-auto {
      flex: 0 1 auto;
      width: auto;
      max-width: 100%;
    }
  }

  // offset calculation mixin
  @mixin offset-calculation($element) {
    @for $i from 1 through $columns-count {
      &-offset-#{$i - 1} {
        margin-left: percentage(($i - 1)/$columns-count);
      }
    }
  }

  @include check-breakpoint($column) {
    @include width-calculation($column);
    @include offset-calculation($column);
  }
}

// helpers
@mixin create-grid-helpers($configuration: $configuration, $breakpoints: $breakpoints) {
  $container: #{map-get($configuration, container)};
  $row: #{map-get($configuration, row)};
  $column: #{map-get($configuration, column)};
  $box-sizing-enabled: map-get($configuration, box-sizing-enabled);
  $row-vertical-alignment-enabled: map-get($configuration, row-vertical-alignment-enabled);
  $row-horizontal-alignment-enabled: map-get($configuration, row-horizontal-alignment-enabled);
  $column-vertical-alignment-enabled: map-get($configuration, column-vertical-alignment-enabled);
  $breakpoints-enabled: map-get($configuration, breakpoints-enabled);

  // box sizing
  @mixin box-sizing-helper() {
    html {
      box-sizing: border-box;
    }

    *,
    *:after,
    *:before {
      box-sizing: inherit;
    }
  }

  // grid container
  @mixin grid-container($element) {
    .#{$element} {
      overflow-x: hidden;
      width: 100%;
      height: 100%;
    }
  }

  // vertical alignment for rows
  @mixin row-vertical-alignment($element) {
    @include check-breakpoint($element) {
      &--top {
        align-items: flex-start;
      }

      &--middle {
        align-items: center;
      }

      &--baseline {
        align-items: baseline;
      }

      &--bottom {
        align-items: flex-end;
      }

      &--stretch {
        align-items: stretch;
      }
    }
  }

  // space distribution
  @mixin row-horizontal-alignment($element) {
    @include check-breakpoint($element) {
      &--left {
        justify-content: flex-start;
      }

      &--center {
        justify-content: center;
      }

      &--right {
        justify-content: flex-end;
      }

      &--between {
        justify-content: space-between;
      }

      &--around {
        justify-content: space-around;
      }
    }
  }

  // flex wrap
  @mixin row-wrap($element) {
    @include check-breakpoint($element) {
      &--multi {
        flex-wrap: wrap;
      }

      &--line {
        flex-wrap: nowrap;
      }
    }
  }

  // align self (for columns)
  @mixin column-vertical-alignment($element) {
    @include check-breakpoint($element) {
      &--top {
        align-self: flex-start;
      }

      &--middle {
        align-self: center;
      }

      &--baseline {
        align-self: baseline;
      }

      &--bottom {
        align-self: flex-end;
      }

      &--stretch {
        align-self: stretch;
      }
    }
  }

  @if $box-sizing-enabled {
    @include box-sizing-helper();
  }

  @include grid-container(#{$container});
  @include row-wrap(#{$row});

  @if $row-vertical-alignment-enabled {
    @include row-vertical-alignment(#{$row});
  }

  @if $row-horizontal-alignment-enabled {
    @include row-horizontal-alignment(#{$row});
  }

  @if $column-vertical-alignment-enabled {
    @include column-vertical-alignment(#{$column});
  }
}